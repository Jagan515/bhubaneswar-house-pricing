name: Docker Image CI

on:
  push:
    branches: [ "main" ]

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
      - name: Print Repository checked out
        run: echo "✔️ Step 1 complete Repository code downloaded to runner"

      - name: Set up Docker Buildx
        uses: docker/setup-buildx-action@v2
      - name: Print Buildx ready
        run: echo "Step 2:complete Docker Buildx is configured"

      # Optional: login to registry (uncomment if you want to push)
      # - name: Log in to Docker Hub
      #   if: secrets.DOCKERHUB_USERNAME && secrets.DOCKERHUB_TOKEN
      #   uses: docker/login-action@v2
      #   with:
      #     registry: docker.io
      #     username: ${{ secrets.DOCKERHUB_USERNAME }}
      #     password: ${{ secrets.DOCKERHUB_TOKEN }}

      - name: Build the Docker image
        run: |
          IMAGE_NAME="my-image-name"
          TAG=${GITHUB_SHA::8}
          docker build --file Dockerfile --tag "${IMAGE_NAME}:${TAG}" .
          docker image ls "${IMAGE_NAME}:${TAG}"
          echo "✔️ Step 3 complete: Docker image built successfully with tag ${IMAGE_NAME}:${TAG}"

      # Optional: push to registry (uncomment block and set secrets)
      # - name: Push to Docker Hub
      #   if: secrets.DOCKERHUB_USERNAME && secrets.DOCKERHUB_TOKEN
      #   run: |
      #     IMAGE_NAME="my-image-name"
      #     TAG=${GITHUB_SHA::8}
      #     docker tag "${IMAGE_NAME}:${TAG}" "${{ secrets.DOCKERHUB_USERNAME }}/${IMAGE_NAME}:${TAG}"
      #     docker push "${{ secrets.DOCKERHUB_USERNAME }}/${IMAGE_NAME}:${TAG}"
